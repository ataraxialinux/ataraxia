# Description: The Linux kernel
# URL:         https://www.kernel.org/
# Maintainer:  protonesso, nagakamira at gmail dot com

name=linux
version=4.17.9
release=6
source=(https://cdn.kernel.org/pub/linux/kernel/v4.x/$name-$version.tar.xz)

build() {
	yconfig() {
		while [ $# -ne 0 ]; do
			sed -i "s/.*CONFIG_$1\ .*/CONFIG_$1=y/" .config
			grep ^"CONFIG_$1=y" .config || echo "CONFIG_$1=y" >> .config
			shift 1
		done
	}

	mconfig() {
		while [ $# -ne 0 ]; do
			sed -i "s/.*CONFIG_$1\ .*/CONFIG_$1=m/" .config
			grep ^"CONFIG_$1=m" .config || echo "CONFIG_$1=m" >> .config
			shift 1
		done
	}

	nconfig() {
		while [ $# -ne 0 ]; do
			sed -i "s/.*CONFIG_$1\ .*/CONFIG_$1=n/" .config
			grep ^"CONFIG_$1=n" .config || echo "CONFIG_$1=n" >> .config
			shift 1
		done
	}

	cd $name-$version
	unset LDFLAGS
	make mrproper

	make ARCH=$XKARCH CROSS_COMPILE=$CROSS_COMPILE defconfig

	case $BARCH in
		x86_64)
			yconfig 64BIT UNWINDER_FRAME_POINTER PCI BLK_DEV_SD ATA ATA_SFF ATA_BMDMA ATA_PIIX \
				E1000 SERIAL_8250 SERIAL_8250_CONSOLE=y CONFIG_RTC_CLASS \
				IA32_EMULATION EFI EFI_STUB EFI_MIXED EFI_VARS FB_EFI EFI_RUNTIME_MAP EFIVAR_FS CRYPTO_AES_X86_64 KVM_INTEL KVM_AMD
			;;
		i686)
			yconfig MPENTIUMII UNWINDER_FRAME_POINTER PCI BLK_DEV_SD ATA ATA_SFF ATA_BMDMA ATA_PIIX \
				E1000 SERIAL_8250 SERIAL_8250_CONSOLE=y CONFIG_RTC_CLASS \
				EFI EFI_STUB EFI_MIXED EFI_VARS FB_EFI EFI_RUNTIME_MAP EFIVAR_FS KVM_INTEL KVM_AMD
			;;
		armv7h)
			yconfig MMU ARCH_MULTI_V7 ARCH_VIRT SOC_DRA7XX=y ARCH_OMAP2PLUS_TYPICAL ARCH_ALPINE ARM_THUMB \
				CONFIG_VDSO CPU_IDLE ARM_CPUIDLE KERNEL_MODE_NEON SERIAL_AMBA_PL011 SERIAL_AMBA_PL011_CONSOLE \
				RTC_CLASS RTC_HCTOSYS RTC_DRV_PL031 NET_CORE VIRTIO_MENU VIRTIO_NET PCI PCI_HOST_GENERIC \
				VIRTIO_BLK VIRTIO_PCI VIRTIO_MMIO ATA ATA_SFF ATA_BMDMA ATA_PIIX PATA_PLATFORM \
				PATA_OF_PLATFORM ATA_GENERIC EFI EFI_STUB EFI_MIXED EFI_VARS FB_EFI EFI_RUNTIME_MAP EFIVAR_FS
			;;
		armv6h)
			yconfig CPU_V6 MMU ARM_THUMB AEABI VFP ARCH_VERSATILE ARCH_VERSATILE_PB PCI_LEGACY SERIAL_NONSTANDARD \
				SERIAL_AMBA_PL011 SERIAL_AMBA_PL011_CONSOLE RTC_DRV_PL031 SCSI_SYM53C8XX_2 SCSI_SYM53C8XX_DMA_ADDRESSING_MODE SCSI_SYM53C8XX_MMIO
			;;
		aarch64)
			yconfig EFI EFI_STUB EFI_MIXED EFI_VARS FB_EFI EFI_RUNTIME_MAP EFIVAR_FS
			;;
		mipsel)
			yconfig MIPS_MALTA CPU_MIPS32_R2 SERIAL_8250 SERIAL_8250_CONSOLE PCI BLK_DEV_SD ATA ATA_SFF ATA_BMDMA ATA_PIIX POWER_RESET POWER_RESET_SYSCON CPU_LITTLE_ENDIAN
			;;
		mips)
			yconfig MIPS_MALTA CPU_MIPS32_R2 SERIAL_8250 SERIAL_8250_CONSOLE PCI BLK_DEV_SD ATA ATA_SFF ATA_BMDMA ATA_PIIX POWER_RESET POWER_RESET_SYSCON
			sed -i -e 's:CONFIG_CPU_LITTLE_ENDIAN:CONFIG_CPU_BIG_ENDIAN:' .config
			;;
		ppc64le)
			yconfig PPC64 POWER8_CPU PPC_PSERIES CPU_LITTLE_ENDIAN PPC_OF_BOOT_TRAMPOLINE BLK_DEV_SD SCSI_LOWLEVEL SCSI_IBMVSCSI ATA IBMVETH HVC_CONSOLE \
				PPC_TRANSACTIONAL_MEM PPC_DISABLE_WERROR SECTION_MISMATCH_WARN_ONLY
			;;
	esac

	yconfig CC_OPTIMIZE_FOR_SIZE OPTIMIZE_INLINING MODULES EARLY_PRINTK BINFMT_ELF BINFMT_SCRIPT NO_HZ HIGH_RES_TIMERS BLK_DEV BLK_DEV_INITRD \
		BLK_DEV_LOOP EXT2_FS EXT3_FS EXT4_FS EXT4_FS_SECURITY EXT4_FS_POSIX_ACL EXT4_ENCRYPTION \
		VFAT_FS MSDOS_FS FUSE_FS JFS_FS REISERFS_FS XFS_FS BTRFS_FS BTRFS_FS_POSIX_ACL \
		REISERFS_FS_XATTR FAT_DEFAULT_UTF8 MISC_FILESYSTEMS \
		SQUASHFS SQUASHFS_XATTR SQUASHFS_ZLIB=y DEVTMPFS DEVTMPFS_MOUNT \
		TMPFS TMPFS_POSIX_ACL NET PACKET UNIX INET IPV6 NETDEVICES BRIDGE NETFILTER TUN \
		WIRELESS CFG80211 CFG80211_WEXT MAC80211 WLAN ETHERNET \
		PPP PPP_ASYNC PPP_SYNC_TTY HID HID_GENERIC HID_WACOM \
		USB USB_HID USB_SUPPORT USB_XHCI_HCD USB_EHCI_HCD USB_OHCI_HCD USB_PRINTER \
		PARTITION_ADVANCED EFI_PARTITION \
		SOUND SND AUTOFS4_FS NETWORK_FILESYSTEMS NFS_FS NFSD NFSD_V4 CIFS \
		BT BT_RFCOMM BT_RFCOMM_TTY BT_BNEP BT_BNEP_MC_FILTER BT_BNEP_PROTO_FILTER BT_HIDP RFKILL \
		CRYPTO CRYPTO_XTS CRYPTO_SHA256 CRYPTO_AES CRYPTO_USER_API_HASH CRYPTO_USER_API_SKCIPHER CRYPTO_TWOFISH \
		MEDIA_CAMERA_SUPPORT MEDIA_USB_SUPPORT \
		MD MD_AUTODETECT MD_LINEAR MD_RAID0 MD_RAID1 MD_RAID10 MD_RAID456 \
		BLK_DEV_DM DM_CRYPT DM_SNAPSHOT DM_THIN_PROVISIONING DM_MIRROR \
		PARPORT PARPORT_PC PRINTER INPUT INPUT_EVDEV INPUT_MISC INPUT_UINPUT \
		I2C_CHARDEV HWMON MAGIC_SYSRQ SUSPEND HIBERNATION VIRTUALIZATION KVM \
		DNOTIFY DRM FB_VESA NAMESPACES UTS_NS IPC_NS USER_NS \
		PID_NS NET_NS DEVPTS_MULTIPLE_INSTANCES CGROUPS \
		CGROUP_DEVICE CPUSETS CGROUP_FREEZER CGROUP_SCHED BLK_CGROUP= CFQ_GROUP_IOSCHED \
		CGROUP_MEM_RES_CTLR CGROUP_MEM_RES_CTLR_SWAP CGROUP_CPUACCT VETH MACVLAN VLAN_8021Q \
		VIRTIO VIRTIO_PCI VIRTIO_NET VIRTIO_BLK VIRTIO_MMIO VIRTIO_BALLOON \
		MEMCG KEYS BRIDGE_NETFILTER NF_NAT_IPV4  IP_NF_FILTER \
		NETFILTER_XT_MATCH_CONNTRACK NETFILTER_XT_MATCH_IPVS IP_NF_NAT NF_NAT NF_NAT_NEEDED \
		IP_NF_NAT NF_NAT NF_NAT_NEEDED POSIX_MQUEUE SECCOMP CGROUP_PIDS \
		MEMCG_SWAP MEMCG_SWAP_ENABLED BLK_DEV_THROTTLING IOSCHED_CFQ CGROUP_PERF CGROUP_HUGETLB \
		NET_CLS_CGROUP CFS_BANDWIDTH FAIR_GROUP_SCHED RT_GROUP_SCHED \
		IP_VS IP_VS_PROTO_TCP IP_VS_PROTO_UDP IP_VS_NFCT IP_VS_RR \
		CRYPTO_AEAD CRYPTO_GCM CRYPTO_SEQIV CRYPTO_GHASH XFRM_ALGO XFRM_USER \
		RESOURCE_COUNTERS NETPRIO_CGROUP CGROUP_NET_PRIO MEMCG_KMEM DEVPTS_MULTIPLE_INSTANCES \
		NETLINK_DIAG PACKET_DIAG INET_UDP_DIAG \
		INET_TCP_DIAG UNIX_DIAG CHECKPOINT_RESTORE SECURITY_APPARMOR AUDIT \
		SECURITY KALLSYMS SECURITY_PATH SECURITY_NETWORK SECURITYFS SECURITY_NETWORK \
		SECURITY_PATH SECURITY_TOMOYO INPUT_TOUCHSCREEN TOUCHSCREEN_PROPERTIES FRAMEBUFFER_CONSOLE \
		CONFIG_EPOLL TIMERFD PERF_EVENTS HW_PERF_EVENTS INPUT_JOYSTICK INPUT_TABLET \
		MOUSE_SYNAPTICS_I2C MOUSE_SYNAPTICS_USB MOUSE_PS2_SYNAPTICS MOUSE_PS2_SYNAPTICS_SMBUS=

	case $BARCH in
		mipsel)
			sed -i -e 's:CONFIG_CPU_BIG_ENDIAN:CONFIG_CPU_LITTLE_ENDIAN:' .config
			;;
		mips)
			sed -i -e 's:CONFIG_CPU_LITTLE_ENDIAN:CONFIG_CPU_BIG_ENDIAN:' .config
			;;
	esac

	# Video drivers
	yconfig DRM_RADEON DRM_AMDGPU DRM_AMDGPU_SI DRM_AMDGPU_CIK \
		DRM_NOUVEAU DRM_NOUVEAU_BACKLIGHT DRM_VMWGFX DRM_VMWGFX_FBCON \
		DRM_I915 DRM_I915_ALPHA_SUPPORT DRM_I915_CAPTURE_ERROR DRM_I915_COMPRESS_ERROR DRM_I915_USERPTR DRM_I915_GVT DRM_I915_GVT_KVMGT \
		VIRTIO_GPU DRM_QLX DRM_GMA500 DRM_GMA600 DRM_GMA3600 DRM_CIRRUS_QEMU

	# Touchscreen drivers
	yconfig TOUCHSCREEN_88PM860X TOUCHSCREEN_ADS7846 TOUCHSCREEN_AD7877 TOUCHSCREEN_AD7879 TOUCHSCREEN_AD7879_I2C TOUCHSCREEN_AD7879_SPI TOUCHSCREEN_AR1021_I2C \
		TOUCHSCREEN_ATMEL_MXT TOUCHSCREEN_ATMEL_MXT_T37 TOUCHSCREEN_AUO_PIXCIR TOUCHSCREEN_BU21013 TOUCHSCREEN_CHIPONE_ICN8318 TOUCHSCREEN_CY8CTMG110 TOUCHSCREEN_CYTTSP_CORE \
		TOUCHSCREEN_CYTTSP_I2C TOUCHSCREEN_CYTTSP_SPI TOUCHSCREEN_CYTTSP4_CORE TOUCHSCREEN_CYTTSP4_I2C TOUCHSCREEN_CYTTSP4_SPI TOUCHSCREEN_DA9034 TOUCHSCREEN_DA9052 \
		TOUCHSCREEN_DYNAPRO TOUCHSCREEN_HAMPSHIRE TOUCHSCREEN_EETI TOUCHSCREEN_EGALAX TOUCHSCREEN_EGALAX_SERIAL TOUCHSCREEN_EXC3000 TOUCHSCREEN_FUJITSU TOUCHSCREEN_GOODIX \
		TOUCHSCREEN_HIDEEP TOUCHSCREEN_ILI210X TOUCHSCREEN_S6SY761 TOUCHSCREEN_GUNZE TOUCHSCREEN_EKTF2127 TOUCHSCREEN_ELAN TOUCHSCREEN_ELO TOUCHSCREEN_WACOM_W8001 \
		TOUCHSCREEN_WACOM_I2C TOUCHSCREEN_MAX11801 TOUCHSCREEN_MCS5000 TOUCHSCREEN_MMS114 TOUCHSCREEN_MELFAS_MIP4 TOUCHSCREEN_MTOUCH \
		TOUCHSCREEN_IMX6UL_TSC TOUCHSCREEN_INEXIO TOUCHSCREEN_MK712 TOUCHSCREEN_PENMOUNT TOUCHSCREEN_EDT_FT5X06 TOUCHSCREEN_TOUCHRIGHT TOUCHSCREEN_TOUCHWIN \
		TOUCHSCREEN_TI_AM335X_TSC TOUCHSCREEN_UCB1400 TOUCHSCREEN_PIXCIR TOUCHSCREEN_WDT87XX_I2C TOUCHSCREEN_WM831X TOUCHSCREEN_WM97XX TOUCHSCREEN_WM9705 \
		TOUCHSCREEN_WM9712 TOUCHSCREEN_WM9713 TOUCHSCREEN_USB_COMPOSITE TOUCHSCREEN_MC13783 TOUCHSCREEN_USB_EGALAX TOUCHSCREEN_USB_PANJIT TOUCHSCREEN_USB_3M \
		TOUCHSCREEN_USB_ITM TOUCHSCREEN_USB_ETURBO TOUCHSCREEN_USB_GUNZE TOUCHSCREEN_USB_DMC_TSC10 TOUCHSCREEN_USB_IRTOUCH TOUCHSCREEN_USB_IDEALTEK \
		TOUCHSCREEN_USB_GENERAL_TOUCH TOUCHSCREEN_USB_GOTOP TOUCHSCREEN_USB_JASTEC TOUCHSCREEN_USB_ELO TOUCHSCREEN_USB_E2I TOUCHSCREEN_USB_ZYTRONIC \
		TOUCHSCREEN_USB_ETT_TC45USB TOUCHSCREEN_USB_NEXIO TOUCHSCREEN_USB_EASYTOUCH TOUCHSCREEN_TOUCHIT213 TOUCHSCREEN_TSC_SERIO TOUCHSCREEN_TSC200X_CORE \
		TOUCHSCREEN_TSC2004 TOUCHSCREEN_TSC2005 TOUCHSCREEN_TSC2007 TOUCHSCREEN_TSC2007_IIO TOUCHSCREEN_PCAP TOUCHSCREEN_RM_TS TOUCHSCREEN_SILEAD \
		TOUCHSCREEN_SIS_I2C TOUCHSCREEN_ST1232 TOUCHSCREEN_STMFTS TOUCHSCREEN_STMPE TOUCHSCREEN_SUR40 TOUCHSCREEN_SURFACE3_SPI TOUCHSCREEN_SX8654 \
		TOUCHSCREEN_TPS6507X TOUCHSCREEN_ZET6223 TOUCHSCREEN_ZFORCE TOUCHSCREEN_COLIBRI_VF50 TOUCHSCREEN_ROHM_BU21023

	# Joystick drivers
	yconfig JOYSTICK_ANALOG JOYSTICK_A3D JOYSTICK_ADI JOYSTICK_COBRA JOYSTICK_GF2K JOYSTICK_GRIP JOYSTICK_GRIP_MP \
		JOYSTICK_GUILLEMOT JOYSTICK_INTERACT JOYSTICK_SIDEWINDER JOYSTICK_TMDC JOYSTICK_IFORCE JOYSTICK_IFORCE_USB \
		JOYSTICK_IFORCE_232 JOYSTICK_WARRIOR JOYSTICK_MAGELLAN JOYSTICK_SPACEORB JOYSTICK_SPACEBALL JOYSTICK_STINGER \
		JOYSTICK_TWIDJOY JOYSTICK_ZHENHUA JOYSTICK_DB9 JOYSTICK_GAMECON JOYSTICK_TURBOGRAFX JOYSTICK_AS5011 JOYSTICK_JOYDUMP \
		JOYSTICK_XPAD JOYSTICK_XPAD_FF JOYSTICK_XPAD_LEDS JOYSTICK_WALKERA0701 JOYSTICK_PSXPAD_SPI JOYSTICK_PSXPAD_SPI_FF JOYSTICK_PXRC

	# Tablet drivers
	yconfig TABLET_USB_ACECAD TABLET_USB_AIPTEK TABLET_USB_GTCO TABLET_USB_HANWANG TABLET_USB_KBTAB TABLET_USB_PEGASUS TABLET_SERIAL_WACOM4

	# Sound drivers
	yconfig SND_DUMMY SND_ALOOP SND_VIRMIDI SND_MTPAV SND_MTS64 SND_SERIAL_U16550 SND_MPU401 SND_PORTMAN2X4 \
		SND_AC97_POWER_SAVE SND_SB_COMMON SND_PCI SND_AD1889 SND_ALS300 SND_ALS4000 SND_ALI5451 SND_ASIHPI SND_ATIIXP \
		SND_ATIIXP_MODEM SND_AU8810 SND_AU8820 SND_AU8830 SND_AW2 SND_AZT3328 SND_BT87X SND_CA0106 SND_CMIPCI SND_OXYGEN_LIB \
		SND_OXYGEN SND_CS4281 SND_CS46XX SND_CS46XX_NEW_DSP SND_CTXFI SND_DARLA20 SND_GINA20 SND_LAYLA20 SND_DARLA24 \
		SND_GINA24 SND_LAYLA24 SND_MONA SND_MIA SND_ECHO3G SND_INDIGO SND_INDIGOIO SND_INDIGODJ SND_INDIGOIOX \
		SND_INDIGODJX SND_EMU10K1 SND_EMU10K1_SEQ SND_EMU10K1X SND_ENS1370 SND_ENS1371 SND_ES1938 SND_ES1968 \
		SND_ES1968_INPUT SND_ES1968_RADIO SND_FM801 SND_FM801_TEA575X_BOOL SND_HDSP SND_HDSPM SND_ICE1712 SND_ICE1724 \
		SND_INTEL8X0 SND_INTEL8X0M SND_KORG1212 SND_LOLA SND_LX6464ES SND_MAESTRO3 SND_MAESTRO3_INPUT SND_MIXART \
		SND_NM256 SND_PCXHR SND_RIPTIDE SND_RME32 SND_RME96 SND_RME9652 SND_SONICVIBES SND_TRIDENT SND_VIA82XX \
		SND_VIA82XX_MODEM SND_VIRTUOSO SND_VX222 SND_YMFPCI

	# HD-Audio drivers
	yconfig SND_HDA SND_HDA_INTEL SND_HDA_HWDEP SND_HDA_RECONFIG SND_HDA_INPUT_BEEP SND_HDA_PATCH_LOADER \
		SND_HDA_CODEC_REALTEK _SND_HDA_CODEC_ANALOG SND_HDA_CODEC_SIGMATEL SND_HDA_CODEC_VIA SND_HDA_CODEC_HDMI \
		SND_HDA_CODEC_CIRRUS ND_HDA_CODEC_CONEXANT SND_HDA_CODEC_CA0110 SND_HDA_CODEC_CA0132 SND_HDA_CODEC_CA0132_DSP \
		SND_HDA_CODEC_CMEDIA SND_HDA_CODEC_SI3054 SND_HDA_GENERIC SND_HDA_CORE SND_HDA_DSP_LOADER SND_HDA_I915 \
		SND_HDA_EXT_COR SND_SPI SND_USB SND_USB_AUDIO SND_USB_UA101 SND_USB_USX2Y SND_USB_CAIAQ SND_USB_CAIAQ_INPUT \
		SND_USB_US122L SND_USB_6FIRE SND_USB_HIFACE SND_BCD2000 SND_USB_LINE6 SND_USB_POD SND_USB_PODHD SND_USB_TONEPORT \
		SND_USB_VARIAX SND_FIREWIRE SND_FIREWIRE_LIB SND_DICE SND_OXFW SND_ISIGHT SND_FIREWORKS SND_BEBOB SND_FIREWIRE_DIGI00X \
		SND_FIREWIRE_TASCAM SND_FIREWIRE_MOTU SND_FIREFACE _SND_PCMCIA SND_VXPOCKET SND_PDAUDIOCF SND_SOC SND_SOC_AC97_BUS \
		SND_SOC_GENERIC_DMAENGINE_PCM SND_SOC_COMPRESS SND_SOC_TOPOLOGY SND_SOC_ACPI SND_SOC_AMD_ACP SND_SOC_AMD_CZ_DA7219MX98357_MACH \
		SND_SOC_AMD_CZ_RT5645_MACH SND_ATMEL_SOC SND_DESIGNWARE_I2S SND_DESIGNWARE_PCM

	# CODEC drivers
	yconfig SND_SOC_AC97_CODEC SND_SOC_ADAU_UTILS SND_SOC_ADAU1701 SND_SOC_ADAU17X1 SND_SOC_ADAU1761 SND_SOC_ADAU1761_I2C SND_SOC_ADAU1761_SPI \
		SND_SOC_ADAU7002 SND_SOC_AK4104 SND_SOC_AK4458 SND_SOC_AK4554 SND_SOC_AK4613 _SND_SOC_AK4642 SND_SOC_AK5386 SND_SOC_AK5558 SND_SOC_ALC5623 \
		SND_SOC_BD28623 SND_SOC_CPCAP SND_SOC_CS35L32 SND_SOC_CS35L33 SND_SOC_CS35L34 SND_SOC_CS35L35 SND_SOC_CS42L42 \
		SND_SOC_CS42L51 SND_SOC_CS42L51_I2C SND_SOC_CS42L52 SND_SOC_CS42L56 SND_SOC_CS42L73 SND_SOC_CS4265 SND_SOC_CS4270 \
		SND_SOC_CS4271 SND_SOC_CS4271_I2C SND_SOC_CS4271_SPI SND_SOC_CS42XX8 SND_SOC_CS42XX8_I2C SND_SOC_CS43130 SND_SOC_CS4349 \
		SND_SOC_CS53L30 SND_SOC_DA7213 SND_SOC_DA7219 SND_SOC_DIO2125 SND_SOC_DMIC SND_SOC_HDMI_CODEC SND_SOC_ES7134 SND_SOC_ES8316 \
		SND_SOC_ES8328 SND_SOC_ES8328_I2C SND_SOC_ES8328_SPI SND_SOC_GTM601 SND_SOC_HDAC_HDMI SND_SOC_INNO_RK3036 SND_SOC_MAX98090 \
		SND_SOC_MAX98357A SND_SOC_MAX98504 SND_SOC_MAX9867 SND_SOC_MAX98927 SND_SOC_MAX98373 SND_SOC_MAX9860 SND_SOC_MSM8916_WCD_ANALOG \
		SND_SOC_MSM8916_WCD_DIGITAL SND_SOC_PCM1681 SND_SOC_PCM1789 SND_SOC_PCM1789_I2C SND_SOC_PCM179X SND_SOC_PCM179X_I2C \
		SND_SOC_PCM179X_SPI SND_SOC_PCM186X SND_SOC_PCM186X_I2C SND_SOC_PCM186X_SPI SND_SOC_PCM3168A SND_SOC_PCM3168A_I2C \
		SND_SOC_PCM3168A_SPI SND_SOC_PCM512x SND_SOC_PCM512x_I2C SND_SOC_PCM512x_SPI SND_SOC_RL6231 SND_SOC_RL6347A \
		SND_SOC_RT286 SND_SOC_RT298 SND_SOC_RT5514 SND_SOC_RT5514_SPI SND_SOC_RT5616 SND_SOC_RT5631 SND_SOC_RT5640 \
		SND_SOC_RT5645 SND_SOC_RT5651 SND_SOC_RT5663 SND_SOC_RT5670 SND_SOC_RT5677 SND_SOC_RT5677_SPI SND_SOC_SGTL5000 \
		SND_SOC_SI476X SND_SOC_SIGMADSP SND_SOC_SIGMADSP_I2C SND_SOC_SIGMADSP_REGMAP SND_SOC_SIRF_AUDIO_CODEC SND_SOC_SPDIF \
		SND_SOC_SSM2602 SND_SOC_SSM2602_SPI SND_SOC_SSM2602_I2C SND_SOC_SSM4567 SND_SOC_STA32X SND_SOC_STA350 SND_SOC_STI_SAS \
		SND_SOC_TAS2552 SND_SOC_TAS5086 SND_SOC_TAS571X SND_SOC_TAS5720 SND_SOC_TAS6424 SND_SOC_TDA7419 SND_SOC_TFA9879 \
		SND_SOC_TLV320AIC23 SND_SOC_TLV320AIC23_I2C SND_SOC_TLV320AIC23_SPI SND_SOC_TLV320AIC31XX SND_SOC_TLV320AIC32X4 \
		SND_SOC_TLV320AIC32X4_I2C SND_SOC_TLV320AIC32X4_SPI SND_SOC_TLV320AIC3X SND_SOC_TS3A227E SND_SOC_TSCS42XX \
		SND_SOC_WM8510 SND_SOC_WM8523 SND_SOC_WM8524 SND_SOC_WM8580 SND_SOC_WM8711 SND_SOC_WM8728 SND_SOC_WM8731 \
		SND_SOC_WM8737 SND_SOC_WM8741 SND_SOC_WM8750 SND_SOC_WM8753 SND_SOC_WM8770 SND_SOC_WM8776 SND_SOC_WM8804 \
		SND_SOC_WM8804_I2C SND_SOC_WM8804_SPI SND_SOC_WM8903 SND_SOC_WM8960 SND_SOC_WM8962 SND_SOC_WM8974 \
		SND_SOC_WM8978 SND_SOC_WM8985 SND_SOC_ZX_AUD96P22 SND_SOC_MAX9759 SND_SOC_NAU8540 SND_SOC_NAU8810 \
		SND_SOC_NAU8824 SND_SOC_NAU8825 SND_SOC_TPA6130A2 SND_SIMPLE_CARD_UTILS SND_SIMPLE_CARD \
		SND_SIMPLE_SCU_CARD SND_AUDIO_GRAPH_CARD SND_AUDIO_GRAPH_SCU_CARD HDMI_LPE_AUDIO SND_SYNTH_EMUX AC97_BUS

	# HID drivers
	yconfig HID_A4TECH HID_ACCUTOUCH HID_ACRUX HID_ACRUX_FF HID_APPLE HID_APPLEIR HID_ASUS HID_AUREAL HID_BELKIN HID_BETOP_FF \
		HID_CHERRY HID_CHICONY HID_CORSAIR HID_PRODIKEYS HID_CMEDIA HID_CP2112 HID_CYPRESS HID_DRAGONRISE DRAGONRISE_FF \
		HID_EMS_FF HID_ELAN HID_ELECOM HID_ELO HID_EZKEY HID_GEMBIRD HID_GFRM HID_HOLTEK HOLTEK_FF HID_GOOGLE_HAMMER \
		HID_GT683R HID_KEYTOUCH HID_KYE HID_UCLOGIC HID_WALTOP HID_GYRATION HID_ICADE HID_IT HID_JABRA HID_TWINHAN HID_KENSINGTON \
		HID_LCPOWER HID_LED HID_LENOVO HID_LOGITECH HID_LOGITECH_DJ HID_LOGITECH_HIDPP LOGITECH_FF LOGIRUMBLEPAD2_FF LOGIG940_FF \
		LOGIWHEELS_FF HID_MAGICMOUSE HID_MAYFLASH HID_MICROSOFT HID_MONTEREY HID_MULTITOUCH HID_NTI HID_NTRIG HID_ORTEK HID_PANTHERLORD \
		PANTHERLORD_FF HID_PENMOUNT HID_PETALYNX HID_PICOLCD _HID_PICOLCD_FB HID_PICOLCD_BACKLIGHT HID_PICOLCD_LCD HID_PICOLCD_LEDS \
		HID_PICOLCD_CIR HID_PLANTRONICS HID_PRIMAX _HID_RETRODE HID_ROCCAT HID_SAITEK HID_SAMSUNG HID_SONY SONY_FF HID_SPEEDLINK \
		HID_STEELSERIES HID_SUNPLUS HID_RMI HID_GREENASIA GREENASIA_FF HID_HYPERV_MOUSE HID_SMARTJOYPLUS SMARTJOYPLUS_FF \
		HID_TIVO HID_TOPSEED HID_THINGM HID_THRUSTMASTER THRUSTMASTER_FF HID_UDRAW_PS3 HID_WACOM HID_WIIMOTE HID_XINMO \
		HID_ZEROPLUS ZEROPLUS_FF HID_ZYDACRON HID_SENSOR_HUB HID_ALPS

	# USB storage drivers
	yconfig USB_STORAGE_REALTEK REALTEK_AUTOPM _USB_STORAGE_DATAFAB USB_STORAGE_FREECOM USB_STORAGE_ISD200 \
		USB_STORAGE_USBAT USB_STORAGE_SDDR09 USB_STORAGE_SDDR55 USB_STORAGE_JUMPSHOT USB_STORAGE_ALAUDA \
		USB_STORAGE_ONETOUCH USB_STORAGE_KARMA USB_STORAGE_CYPRESS_ATACB USB_STORAGE_ENE_UB6250 USB_UA

	# USB port drivers
	yconfig USB_USS720 USB_SERIAL USB_SERIAL_GENERIC USB_SERIAL_SIMPLE USB_SERIAL_AIRCABLE USB_SERIAL_ARK3116 USB_SERIAL_BELKIN \
		USB_SERIAL_CH341 USB_SERIAL_WHITEHEAT USB_SERIAL_DIGI_ACCELEPORT USB_SERIAL_CP210X USB_SERIAL_CYPRESS_M8 \
		USB_SERIAL_EMPEG USB_SERIAL_FTDI_SIO USB_SERIAL_VISOR USB_SERIAL_IPAQ USB_SERIAL_IR USB_SERIAL_EDGEPORT \
		USB_SERIAL_EDGEPORT_TI USB_SERIAL_F81232 USB_SERIAL_F8153X USB_SERIAL_GARMIN USB_SERIAL_IPW USB_SERIAL_IUU \
		USB_SERIAL_KEYSPAN_PDA USB_SERIAL_KEYSPAN USB_SERIAL_KLSI USB_SERIAL_KOBIL_SCT USB_SERIAL_MCT_U232 \
		USB_SERIAL_METRO USB_SERIAL_MOS7720 USB_SERIAL_MOS7715_PARPORT USB_SERIAL_MOS7840 USB_SERIAL_MXUPORT \
		USB_SERIAL_NAVMAN USB_SERIAL_PL2303 USB_SERIAL_OTI6858 USB_SERIAL_QCAUX USB_SERIAL_QUALCOMM \
		USB_SERIAL_SPCP8X5 USB_SERIAL_SAFE USB_SERIAL_SIERRAWIRELESS USB_SERIAL_SYMBO USB_SERIAL_TI \
		USB_SERIAL_CYBERJACK USB_SERIAL_XIRCOM USB_SERIAL_WWAN USB_SERIAL_OPTION USB_SERIAL_OMNINET \
		USB_SERIAL_OPTICON USB_SERIAL_XSENS_MT USB_SERIAL_WISHBONE USB_SERIAL_SSU100 USB_SERIAL_QT2 \
		USB_SERIAL_UPD78F0730 USB_SERIAL_DEBUG

	# USB misc
	yconfig USB_EMI62 USB_EMI26 USB_ADUTUX USB_SEVSEG USB_RIO500 _USB_LEGOTOWER USB_LCD USB_CYPRESS_CY7C63 USB_CYTHERM USB_IDMOUSE \
		USB_FTDI_ELAN USB_APPLEDISPLAY USB_SISUSBVGA USB_SISUSBVGA_CON USB_LD USB_TRANCEVIBRATOR USB_IOWARRIOR USB_TEST \
		USB_EHSET_TEST_FIXTURE USB_ISIGHTFW USB_YUREX USB_EZUSB_FX2 USB_HUB_USB251XB USB_HSIC_USB3503 USB_HSIC_USB4604 \
		USB_LINK_LAYER_TEST USB_CHAOSKEY USB_ATM USB_SPEEDTOUCH USB_CXACRU USB_UEAGLEATM USB_XUSBATM

	# Framebuffer
	yconfig FB_HYPERV FB_SIMPLE BACKLIGHT_LCD_SUPPORT LCD_CLASS_DEVIC LCD_L4F00242T03 LCD_LMS283GF05 LCD_LTV350QV \
		LCD_ILI922X LCD_ILI9320 LCD_TDO24M LCD_VGG2432A4 LCD_PLATFORM LCD_S6E63M0 LCD_LD9040 LCD_AMS369FG06 \
		LCD_LMS501KF03 LCD_HX8357 BACKLIGHT_CLASS_DEVICE BACKLIGHT_GENERIC BACKLIGHT_LM3533 BACKLIGHT_PWM \
		BACKLIGHT_DA903X BACKLIGHT_DA9052 BACKLIGHT_MAX8925 BACKLIGHT_APPLE BACKLIGHT_PM8941_WLED BACKLIGHT_SAHARA \
		BACKLIGHT_WM831X BACKLIGHT_ADP5520 BACKLIGHT_ADP8860 BACKLIGHT_ADP8870 BACKLIGHT_88PM860X BACKLIGHT_PCF50633 \
		BACKLIGHT_AAT2870 BACKLIGHT_LM3630A BACKLIGHT_LM3639 BACKLIGHT_LP855X BACKLIGHT_LP8788 BACKLIGHT_PANDORA \
		BACKLIGHT_SKY81452 BACKLIGHT_TPS65217 BACKLIGHT_AS3711 BACKLIGHT_GPIO BACKLIGHT_LV5207LP BACKLIGHT_BD6107 \
		BACKLIGHT_ARCXCNN VIDEOMODE_HELPERS HDMI

	# Misc
	yconfig ATM_DRIVERS USB_NET_DRIVERS IEEE802154_DRIVERS V4L_PLATFORM_DRIVERS V4L_MEM2MEM_DRIVERS V4L_TEST_DRIVERS DVB_PLATFORM_DRIVERS \
		CEC_PLATFORM_DRIVERS SDR_PLATFORM_DRIVERS SND_DRIVERS VIRT_DRIVERS COMEDI_MISC_DRIVERS COMEDI_PCI_DRIVERS COMEDI_PCMCIA_DRIVERS COMEDI_USB_DRIVERS MOUSE_APPLETOUCH

	# Network drivers
	yconfig NET_VENDOR_3COM NET_VENDOR_ADAPTEC NET_VENDOR_AGERE NET_VENDOR_ALACRITECH NET_VENDOR_ALTEON NET_VENDOR_AMAZON NET_VENDOR_AMD \
		NET_VENDOR_AQUANTIA NET_VENDOR_ARC NET_VENDOR_ATHEROS NET_VENDOR_AURORA NET_VENDOR_BROADCOM _NET_VENDOR_BROCADE NET_VENDOR_CAVIUM \
		NET_VENDOR_CHELSIO NET_VENDOR_CISCO NET_VENDOR_CORTINA NET_VENDOR_DEC NET_VENDOR_DLINK NET_VENDOR_EMULEX NET_VENDOR_EZCHIP NET_VENDOR_EXAR \
		NET_VENDOR_FUJITSU NET_VENDOR_HP NET_VENDOR_HUAWEI NET_VENDOR_INTEL NET_VENDOR_I825XX NET_VENDOR_MARVELL NET_VENDOR_MELLANOX NET_VENDOR_MICREL \
		NET_VENDOR_MICROCHIP NET_VENDOR_MYRI NET_VENDOR_NATSEMI NET_VENDOR_NETRONOME NET_VENDOR_NI NET_VENDOR_8390 NET_VENDOR_NVIDIA NET_VENDOR_OKI \
		NET_VENDOR_QLOGIC NET_VENDOR_QUALCOMM NET_VENDOR_REALTEK NET_VENDOR_RENESAS NET_VENDOR_RDC NET_VENDOR_ROCKER NET_VENDOR_SAMSUNG NET_VENDOR_SEEQ \
		NET_VENDOR_SILAN NET_VENDOR_SIS NET_VENDOR_SOLARFLARE NET_VENDOR_SMSC NET_VENDOR_SOCIONEXT NET_VENDOR_STMICRO VENDOR_SUN NET_VENDOR_TEHUTI \
		NET_VENDOR_TI NET_VENDOR_VIA NET_VENDOR_WIZNET NET_VENDOR_XIRCOM NET_VENDOR_SYNOPSYS NET_VENDOR_IBM

	# Wireless drivers
	yconfig WLAN_VENDOR_ADMTEK WLAN_VENDOR_ATH WLAN_VENDOR_ATMEL WLAN_VENDOR_BROADCOM WLAN_VENDOR_CISCO WLAN_VENDOR_INTEL WLAN_VENDOR_INTERSIL \
		WLAN_VENDOR_MARVELL WLAN_VENDOR_MEDIATEK WLAN_VENDOR_RALINK WLAN_VENDOR_REALTEK WLAN_VENDOR_RSI WLAN_VENDOR_ST WLAN_VENDOR_TI WLAN_VENDOR_ZYDAS WLAN_VENDOR_QUANTENNA

	# Framebuffer drivers
	yconfig FIRMWARE_EDID FB_CMDLINE FB_NOTIFY FB_BOOT_VESA_SUPPORT FB_CFB_FILLRECT FB_CFB_COPYAREA \
		FB_CFB_IMAGEBLIT FB_SYS_FILLRECT FB_SYS_COPYAREA FB_SYS_IMAGEBLIT FB_SYS_FOPS FB_DEFERRED_IO FB_BACKLIGHT FB_MODE_HELPERS FB_TILEBLITTING

	# Display panel drivers
	yconfig DRM_PANEL_ARM_VERSATILE DRM_PANEL_LVDS DRM_PANEL_SIMPLE DRM_PANEL_ILITEK_IL9322 DRM_PANEL_INNOLUX_P079ZCA \
		DRM_PANEL_JDI_LT070ME05000 DRM_PANEL_SAMSUNG_LD9040 DRM_PANEL_LG_LG4573 DRM_PANEL_ORISETECH_OTM8009A \
		DRM_PANEL_PANASONIC_VVX10F034N00 DRM_PANEL_RASPBERRYPI_TOUCHSCREEN DRM_PANEL_RAYDIUM_RM68200 \
		DRM_PANEL_SAMSUNG_S6E3HA2 DRM_PANEL_SAMSUNG_S6E63J0X03 DRM_PANEL_SAMSUNG_S6E8AA0 DRM_PANEL_SEIKO_43WVF1G \
		DRM_PANEL_SHARP_LQ101R1SX01 DRM_PANEL_SHARP_LS043T1LE01 DRM_PANEL_SITRONIX_ST7789V DRM_BRIDGE DRM_PANEL_BRIDGE

	# Webcam drivers
	yconfig USB_VIDEO_CLASS USB_VIDEO_CLASS_INPUT_EVDEV USB_GSPCA USB_M5602 USB_STV06XX USB_GL860 \
		USB_GSPCA_BENQ USB_GSPCA_CONEX USB_GSPCA_CPIA1 USB_GSPCA_DTCS033 USB_GSPCA_ETOMS USB_GSPCA_FINEPIX \
		USB_GSPCA_JEILINJ USB_GSPCA_JL2005BCD USB_GSPCA_KINECT USB_GSPCA_KONICA USB_GSPCA_MARS USB_GSPCA_MR97310A \
		USB_GSPCA_NW80X USB_GSPCA_OV519 USB_GSPCA_OV534 USB_GSPCA_OV534_9 USB_GSPCA_PAC207 USB_GSPCA_PAC7302 \
		USB_GSPCA_PAC7311 USB_GSPCA_SE401 USB_GSPCA_SN9C2028 USB_GSPCA_SN9C20X USB_GSPCA_SONIXB USB_GSPCA_SONIXJ \
		USB_GSPCA_SPCA500 USB_GSPCA_SPCA501 USB_GSPCA_SPCA505 USB_GSPCA_SPCA506 USB_GSPCA_SPCA508 USB_GSPCA_SPCA561 \
		USB_GSPCA_SPCA1528 USB_GSPCA_SQ905 USB_GSPCA_SQ905C USB_GSPCA_SQ930X USB_GSPCA_STK014 USB_GSPCA_STK1135 \
		USB_GSPCA_STV0680 USB_GSPCA_SUNPLUS USB_GSPCA_T613 USB_GSPCA_TOPRO USB_GSPCA_TOUPTEK USB_GSPCA_TV8532 \
		USB_GSPCA_VC032X USB_GSPCA_VICAM USB_GSPCA_XIRLINK_CIT USB_GSPCA_ZC3XX USB_PWC USB_PWC_INPUT_EVDEV \
		VIDEO_CPIA2 USB_ZR364XX USB_STKWEBCAM USB_S2255 VIDEO_USBTV

	sed -i "s/.*CONFIG_DEFAULT_HOSTNAME.*/CONFIG_DEFAULT_HOSTNAME=\"janus\"/" .config
	sed -i "s/.*\\(CONFIG_KERNEL_.*\\)=y/\\#\\ \\1 is not set/" .config
	sed -i "s/.*CONFIG_KERNEL_XZ.*/CONFIG_KERNEL_XZ=y/" .config

	yes '' | make ARCH=$XKARCH CROSS_COMPILE=$CROSS_COMPILE silentoldconfig

	make ARCH=$XKARCH CROSS_COMPILE=$CROSS_COMPILE

	make ARCH=$XKARCH CROSS_COMPILE=$CROSS_COMPILE INSTALL_MOD_PATH=$PKG/usr modules_install

	mkdir -p $PKG/boot
	case $BARCH in
		x86_64|i686)
			cp arch/x86/boot/bzImage $PKG/boot/vmlinuz
			;;
		aarch64)
			make ARCH=$XKARCH CROSS_COMPILE=$CROSS_COMPILE INSTALL_DTBS_PATH=$PKG/boot/dtbs dtbs_install
			cp arch/arm64/boot/Image $PKG/boot/vmlinuz
			;;
		armv7h|armv6h)
			make ARCH=$XKARCH CROSS_COMPILE=$CROSS_COMPILE INSTALL_DTBS_PATH=$PKG/boot/dtbs dtbs_install
			cp arch/arm/boot/zImage $PKG/boot/vmlinuz
			;;
		mips|mipsel)
			cp vmlinux $PKG/boot/vmlinuz
			;;
		ppc64le)
			cp vmlinux $PKG/boot/vmlinuz
			;;
	esac
}

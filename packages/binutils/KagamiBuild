# Description: Tools necessary to build programs
# URL:         https://www.gnu.org/software/binutils/
# Maintainer:  protonesso, nagakamira at gmail dot com
# Depends on:  zlib
# Priority:    required
# Section:     devel

name=binutils
version=2.34
release=1
options=('bootstrap')
source=("http://ftp.gnu.org/gnu/$name/$name-$version.tar.xz")

build() {
	case "$BARCH" in
		mips64|mips64el|mips|mipsel)	HASHCONFIG="--enable-default-hash-style=sysv"	;;
		*)				HASHCONFIG="--enable-default-hash-style=gnu"	;;
	esac

	case "$BARCH" in
		x86_64)	ARCHCONFIG="--enable-targets=x86_64-pep"	;;
	esac

	cd "$SRC"/$name-$version
	sed -i "/ac_cpp=/s/\$CPPFLAGS/\$CPPFLAGS -O2/" libiberty/configure

	mkdir build
	cd build

	../configure $TOOLFLAGS $ARCHCONFIG $HASHCONFIG \
		--prefix=/usr \
		--with-bugurl="https://github.com/ataraxialinux/ataraxia/issues" \
		--with-pic \
		--with-system-zlib \
		--enable-deterministic-archives \
		--enable-gold \
		--enable-ld=default \
		--enable-relro \
		--enable-threads \
		--disable-compressed-debug-sections \
		--disable-multilib \
		--disable-nls
	make MAKEINFO="true" configure-host
	make MAKEINFO="true" tooldir=/usr
	make MAKEINFO="true" tooldir=/usr DESTDIR="$PKG" install

	rm -rf "$PKG"/usr/bin/ld
	ln -sf ld.bfd "$PKG"/usr/bin/ld
}

# Maintainer: nee-san <nagakamira@gmail.com>

pkgname=cryptsetup
pkgver=2.1.0
pkgrel=1
pkgdesc="Userspace setup tool for transparent encryption of block devices using dm-crypt"
arch=('x86_64' 'x86' 'arm64' 'armv7l' 'armv5tel' 'ppc64le' 'ppc64' 'ppc')
url="https://gitlab.com/cryptsetup/cryptsetup/"
license=('GPL-2.0-or-later')
depends=('musl' 'popt' 'lvm2' 'libgcrypt' 'json-c' 'argon2')
options=('!emptydirs')
source=("https://www.kernel.org/pub/linux/utils/cryptsetup/v2.1/$pkgname-$pkgver.tar.xz"
	'initd'
	'confd')
md5sums=('41d8b985ef69242852b93e95d53e8e28'
         '05f99b5a3bfb1f49895edc3f0732b15d'
         'cd8d4c33f5016cd0b4516b2bc33507f2')
build() {
	cd "$srcdir"/$pkgname-$pkgver
	./configure \
		--prefix='' \
		--sbindir=/bin \
		--enable-libargon2 \
		--build=$CHOST
	make
}

package() {
	cd "$srcdir"/$pkgname-$pkgver
	make DESTDIR="$pkgdir" install

	install -D -m644 "$srcdir"/confd "$pkgdir"/etc/conf.d/dmcrypt
	install -D -m755 "$srcdir"/initd "$pkgdir"/etc/init.d/dmcrypt
}
